--- original/archive.php	2025-11-19 17:15:32.869507383 -0500
+++ artifacts/exploits/vul4/archive.php	2025-11-21 18:24:43.641295893 -0500
@@ -15,12 +15,16 @@
         $status = 'Could not interpret that reference token.';
     } else {
         $path = trim($decoded);
-        $transcript = @file_get_contents($path);
-        if ($transcript === false) {
-            $transcript = @file_get_contents(__DIR__ . '/logs/' . $path);
-        }
-        if ($transcript === false) {
-            $status = 'No archive entry matched that reference.';
+        if (preg_match('/\/|\.{2}/', $path)) {
+            $status = 'The given reference token is invalid.';
+        } else {
+            $transcript = @file_get_contents($path);
+            if ($transcript === false) {
+                $transcript = @file_get_contents(__DIR__ . '/logs/' . $path);
+            }
+            if ($transcript === false) {
+                $status = 'No archive entry matched that reference.';
+            }
         }
     }
 }
