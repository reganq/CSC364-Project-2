--- original/login.php	2025-11-19 17:15:33.001507319 -0500
+++ artifacts/exploits/vul1/login.php	2025-11-19 18:49:25.137473344 -0500
@@ -1,4 +1,4 @@
-<?php require 'utils.php'; require 'db.php'; $error=null; if($_SERVER['REQUEST_METHOD']==='POST'){ $db=get_db(); $sql="SELECT * FROM users WHERE username = '{$_POST['username']}' AND password = '{$_POST['password']}' LIMIT 1;"; $row=$db->query($sql)->fetch(PDO::FETCH_ASSOC); if($row){ $_SESSION['user']=$row; header('Location:index.php'); exit; } else { $error='Invalid credentials'; }} site_header('Login'); ?>
+<?php require 'utils.php'; require 'db.php'; $error=null; if($_SERVER['REQUEST_METHOD']==='POST'){ $db=get_db(); $stmt=$db->prepare('SELECT * FROM users WHERE username = ? AND password = ? LIMIT 1'); $res=$stmt->execute(array($_POST['username'], $_POST['password'])); $row=$stmt->fetch(PDO::FETCH_ASSOC); if($row){ $_SESSION['user']=$row; header('Location:index.php'); exit; } else { $error="Invalid credentials"; }} site_header('Login'); ?>
 
 <section class="page-header">
   <h1 class="page-title">Welcome back</h1>
--- original/search.php	2025-11-19 17:15:33.169507237 -0500
+++ artifacts/exploits/vul1/search.php	2025-11-19 18:56:50.273261534 -0500
@@ -20,7 +20,7 @@
       <a class="btn link" href="index.php">Back to feed</a>
     </div>
   </form>
-  <?php if($q!==''){ echo "<div class='stack' style='margin-top:18px;'><p class='muted'>Results for: $q</p>"; $db=get_db(); $sql="SELECT id, username FROM users WHERE username LIKE '%$q%'"; foreach($db->query($sql) as $row){ echo "<div><a class='btn link' href='user.php?id={$row['id']}'>".$row['username']."</a></div>"; } echo "</div>"; } ?>
+  <?php if($q!==''){ echo "<div class='stack' style='margin-top:18px;'><p class='muted'>Results for: $q</p>"; $db=get_db(); $stmt=$db->prepare("SELECT id, username FROM users WHERE username LIKE ?"); $stmt->execute(array("%{$q}%")); foreach($stmt->fetchAll() as $row){ echo "<div><a class='btn link' href='user.php?id={$row['id']}'>".$row['username']."</a></div>"; } echo "</div>"; } ?>
 </section>
 
 <?php site_footer(); ?>
--- original/register.php	2025-11-19 17:15:33.137507252 -0500
+++ artifacts/exploits/vul1/register.php	2025-11-19 18:49:35.737468741 -0500
@@ -1,4 +1,4 @@
-<?php require 'utils.php'; require 'db.php'; site_header('Register'); if($_SERVER['REQUEST_METHOD']==='POST'){ $db=get_db(); $sql="INSERT INTO users(username,password) VALUES ('{$_POST['username']}', '{$_POST['password']}')"; try { $db->exec($sql); echo "<section class='card'><h2>Account ready</h2><p class='muted'>You can sign in right away.</p><div class='form-actions'><a class='btn primary' href='login.php'>Proceed to login</a></div></section>"; site_footer(); exit; } catch(Exception $e){ echo "<section class='card'><div class='alert'>Error: ".htmlspecialchars($e->getMessage())."</div></section>"; site_footer(); exit; }} ?>
+<?php require 'utils.php'; require 'db.php'; site_header('Register'); if($_SERVER['REQUEST_METHOD']==='POST'){ $db=get_db(); $stmt=$db->prepare("INSERT INTO users(username,password) VALUES (?, ?)"); try { $stmt->execute(array($_POST['username'], $_POST['password'])); echo "<section class='card'><h2>Account ready</h2><p class='muted'>You can sign in right away.</p><div class='form-actions'><a class='btn primary' href='login.php'>Proceed to login</a></div></section>"; site_footer(); exit; } catch(Exception $e){ echo "<section class='card'><div class='alert'>Error: ".htmlspecialchars($e->getMessage())."</div></section>"; site_footer(); exit; }} ?>
 
 <section class="page-header">
   <h1 class="page-title">Join the Console</h1>
--- original/user.php	2025-11-21 21:13:33.733036852 -0500
+++ artifacts/exploits/vul1/user.php	2025-11-19 18:56:59.337257168 -0500
@@ -1,4 +1,4 @@
-<?php require 'utils.php'; require 'db.php'; $id=$_GET['id']??'1'; $db=get_db(); $row=$db->query("SELECT * FROM users WHERE id = $id")->fetch(PDO::FETCH_ASSOC); if(!$row){ site_header('User Profile'); echo "<section class='card'><div class='alert'>No such user</div><div class='form-actions'><a class='btn link' href='index.php'>Return to feed</a></div></section>"; site_footer(); exit; } site_header('User Profile'); ?>
+<?php require 'utils.php'; require 'db.php'; $id=$_GET['id']??'1'; $db=get_db(); $stmt=$db->prepare("SELECT * FROM users WHERE id = ?"); $stmt->execute(array($id)); $row=$stmt->fetch(PDO::FETCH_ASSOC); if(!$row){ site_header('User Profile'); echo "<section class='card'><div class='alert'>No such user</div><div class='form-actions'><a class='btn link' href='index.php'>Return to feed</a></div></section>"; site_footer(); exit; } site_header('User Profile'); ?>
 
 <section class="page-header">
   <h1 class="page-title">Crew Member</h1>
