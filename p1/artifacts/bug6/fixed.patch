--- p1/original/mini_proto.c	2025-11-06 11:29:10.138672865 -0500
+++ p1/artifacts/bug6/mini_proto.c	2025-11-18 20:18:41.767441071 -0500
@@ -3,22 +3,24 @@
 #include <string.h>
 #include <stdio.h>
 
-size_t encode_record(const record_t *rec, uint8_t *out_buf, size_t out_cap) {
+size_t encode_record(const record_t *rec, uint8_t **out_buf) {
     size_t name_len = strlen(rec->name);
     size_t space = 1 + name_len + 1 + 4 + 2 * rec->score_count;
 
-    if (!out_buf) return space;
+    uint8_t *buf = malloc(space);
 
     size_t off = 0;
-    out_buf[off++] = (uint8_t)name_len;
-    memcpy(out_buf + off, rec->name, name_len); off += name_len;
+    buf[off++] = (uint8_t)name_len;
+    memcpy(buf + off, rec->name, name_len); off += name_len;
 
-    out_buf[off++] = rec->age;
+    buf[off++] = rec->age;
 
-    memcpy(out_buf + off, &rec->score_count, 4); off += 4;
-    memcpy(out_buf + off, rec->scores, 2 * rec->score_count);
+    memcpy(buf + off, &rec->score_count, 4); off += 4;
+    memcpybuf + off, rec->scores, 2 * rec->score_count);
 
     off += 2 * rec->score_count;
+
+    *out_buf = buf;
     return off;
 }
 
--- p1/mini_proto.h	2025-11-06 11:29:10.138672865 -0500
+++ p1/artifacts/bug6/mini_proto.h	2025-11-18 20:15:02.803547401 -0500
@@ -20,9 +20,8 @@
 /* Layout:
    [name_len:1][name_bytes][age:1][score_count:4][scores:2*score_count]
 
-   Returns number of bytes written, or 0 on error.
-   If out_buf == NULL, returns the size that would be needed (non-zero). */
-size_t encode_record(const record_t *rec, uint8_t *out_buf, size_t out_cap);
+   Returns number of bytes written, or 0 on error. */
+size_t encode_record(const record_t *rec, uint8_t **out_buf);
 
 /* Decodes one record. On success:
      - *out points to a newly allocated record_t that you own
--- p1/demo.c	2025-11-06 11:29:10.138672865 -0500
+++ p1/artifacts/bug6/demo.c	2025-11-18 20:17:08.195488650 -0500
@@ -34,9 +34,8 @@
 
     print_record("Input Record", &in);
 
-    size_t need = encode_record(&in, NULL, 0);
-    uint8_t *buf = malloc(need);
-    size_t wrote = encode_record(&in, buf, need);
+    uint8_t *buf;
+    size_t wrote = encode_record(&in, &buf);
     if (wrote == 0) {
         fprintf(stderr, "‚ùå Encode failed\n");
         free(buf);
